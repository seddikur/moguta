# Решение проблем с плагином Firebase Push

## Ошибка: "Ошибка соединения с Firebase. Проверьте API ключ"

### Возможные причины и решения:

#### 1. Неверный API ключ (Server Key)

**Проблема:** Используется неправильный ключ или ключ устарел.

**Решение:**
1. Откройте [Firebase Console](https://console.firebase.google.com/)
2. Выберите ваш проект (`mircvetov-41088`)
3. Перейдите в **Настройки проекта** (⚙️) → **Облачные сообщения** (Cloud Messaging)
4. Найдите **Server Key** (не путать с Web API Key!)
5. Скопируйте ключ полностью (обычно начинается с букв и содержит подчеркивания)
6. Вставьте в поле "API ключ Firebase" в настройках плагина

**Важно:** 
- Используйте именно **Server Key**, а не Web API Key или другие ключи
- Ключ должен быть длинным (обычно 150+ символов)
- Не добавляйте пробелы в начале или конце ключа

#### 2. API ключ не имеет прав на отправку сообщений

**Проблема:** Ключ существует, но не имеет необходимых разрешений.

**Решение:**
1. В Firebase Console проверьте, что Cloud Messaging API включен
2. Убедитесь, что проект активен и не заблокирован
3. Попробуйте создать новый Server Key

#### 3. Проблемы с cURL на сервере

**Проблема:** Расширение cURL не установлено или заблокировано.

**Решение:**
1. Проверьте в разделе "Отладка" плагина, доступно ли расширение cURL
2. Если нет - обратитесь к администратору сервера для установки
3. Проверьте, не блокирует ли файрвол исходящие соединения к `fcm.googleapis.com`

#### 4. Проблемы с SSL сертификатами

**Проблема:** Сервер не может проверить SSL сертификат Firebase.

**Решение:**
- Обновите сертификаты на сервере
- Обратитесь к хостинг-провайдеру

#### 5. Ошибка 404 "API endpoint не найден"

**Проблема:** Firebase возвращает ошибку 404 при тестировании соединения.

**Возможные причины:**
1. Используется неправильный API ключ (не Server Key)
2. Server Key истек или был удален
3. Legacy API отключен для проекта (редко)
4. Неверный формат ключа

**Решение:**
1. **Проверьте тип ключа:**
   - Откройте Firebase Console → Ваш проект → Настройки (⚙️) → Облачные сообщения
   - Найдите **Server Key** (не Web API Key!)
   - Server Key обычно длиннее 100 символов
   - Скопируйте ключ полностью, без пробелов

2. **Проверьте формат ключа:**
   - Должен содержать только буквы, цифры, дефисы и подчеркивания
   - Не должен содержать пробелы в начале или конце
   - Обычно начинается с букв

3. **Создайте новый Server Key:**
   - Если ключ не работает, попробуйте создать новый в Firebase Console
   - Удалите старый ключ и создайте новый

4. **Проверьте проект:**
   - Убедитесь, что проект активен
   - Проверьте, что Cloud Messaging API включен

**Важно:** 
- Используйте именно **Server Key**, а не Web API Key или другие ключи
- Ключ должен быть из раздела "Облачные сообщения" (Cloud Messaging)
- Не используйте ключи из других разделов Firebase

#### 6. Использование устаревшего API

**Проблема:** Firebase постепенно отключает Legacy API.

**Решение:**
- Текущая версия плагина использует Legacy API (`fcm.googleapis.com/fcm/send`)
- Если это не работает, может потребоваться обновление на HTTP v1 API
- Но обычно Legacy API работает, если используется правильный Server Key

### Как проверить правильность API ключа:

1. Откройте консоль браузера (F12)
2. Нажмите "Тестировать соединение" в настройках плагина
3. Проверьте логи в разделе "Отладка"
4. Посмотрите детали ошибки в ответе

### Типичные ошибки Firebase:

- **401 Unauthorized** - Неверный API ключ. Проверьте Server Key в Firebase Console
- **403 Forbidden** - API ключ не имеет прав. Проверьте настройки проекта
- **400 Bad Request** - Неверный формат запроса
- **404 Not Found** - API endpoint не найден. Обычно означает неправильный API ключ или использование не Server Key
- **InvalidRegistration** - Неверный формат регистрации устройства
- **MismatchSenderId** - Неверный Sender ID
- **Unauthorized** - Неверный API ключ (в ответе JSON)

### Дополнительная диагностика:

1. Проверьте логи PHP (error_log)
2. Проверьте логи в разделе "Отладка" плагина
3. Убедитесь, что сервер может делать исходящие HTTPS запросы
4. Проверьте настройки файрвола

### Контакты для поддержки:

Если проблема не решена:
1. Соберите информацию из раздела "Отладка"
2. Проверьте логи сервера
3. Обратитесь к разработчику плагина или администратору сервера

